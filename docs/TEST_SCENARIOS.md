# V-Factory 테스트 시나리오 문서

**버전:** 1.0.0  
**최종 수정일:** 2026-01-13  
**Phase 8: 테스트 및 최적화**

---

## 📋 개요

본 문서는 V-Factory 프로젝트의 테스트 시나리오를 정의합니다. 단위 테스트, 통합 테스트, E2E 테스트, 성능 테스트를 포함합니다.

---

## 🧪 테스트 유형

### 1. 단위 테스트 (Unit Tests)

#### 1.1 Backend API 단위 테스트

**Factory Core Service**

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| FC-001 | 공장 생성 API (`POST /factories`) | 201 Created, 생성된 공장 데이터 반환 |
| FC-002 | 공장 목록 조회 (`GET /factories`) | 200 OK, 공장 목록 배열 반환 |
| FC-003 | 공장 상세 조회 (`GET /factories/{id}`) | 200 OK, 공장 상세 정보 반환 |
| FC-004 | 존재하지 않는 공장 조회 | 404 Not Found, 에러 메시지 반환 |
| FC-005 | 공장 수정 API (`PUT /factories/{id}`) | 200 OK, 수정된 공장 데이터 반환 |
| FC-006 | 공장 레이아웃 수정 (`PUT /factories/{id}/layout`) | 200 OK, 레이아웃 업데이트 확인 |
| FC-007 | 공장 삭제 API (`DELETE /factories/{id}`) | 204 No Content, 삭제 후 조회 시 404 |
| FC-008 | 공장별 CCTV 설정 목록 조회 | 200 OK, CCTV 설정 배열 반환 |
| FC-009 | 헬스체크 엔드포인트 | 200 OK, `{"status": "healthy"}` 반환 |

**Incident Event Service**

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| IE-001 | 사고 생성 API (`POST /incidents`) | 201 Created, 사고 데이터 반환, `is_resolved=false` |
| IE-002 | 사고 목록 조회 (`GET /incidents`) | 200 OK, 사고 목록 배열 반환 |
| IE-003 | 공장 ID로 사고 필터링 | 200 OK, 해당 공장의 사고만 반환 |
| IE-004 | 해결 상태로 사고 필터링 | 200 OK, 필터링된 사고 목록 반환 |
| IE-005 | 사고 상세 조회 (`GET /incidents/{id}`) | 200 OK, 사고 상세 정보 반환 |
| IE-006 | 존재하지 않는 사고 조회 | 404 Not Found, 에러 메시지 반환 |
| IE-007 | 사고 수정 API (`PUT /incidents/{id}`) | 200 OK, 수정된 사고 데이터 반환 |
| IE-008 | 사고 해결 처리 (`is_resolved=true`) | 200 OK, `resolved_at` 타임스탬프 설정 |
| IE-009 | 사고 삭제 API (`DELETE /incidents/{id}`) | 204 No Content, 삭제 확인 |
| IE-010 | 헬스체크 엔드포인트 | 200 OK, `{"status": "healthy"}` 반환 |

**Asset Management Service**

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| AM-001 | 에셋 목록 조회 (`GET /assets`) | 200 OK, 에셋 목록 배열 반환 |
| AM-002 | 존재하지 않는 에셋 조회 | 404 Not Found, 에러 메시지 반환 |
| AM-003 | 에셋 메타데이터 조회 | 200 OK 또는 404 Not Found |
| AM-004 | 헬스체크 엔드포인트 | 200 OK, `{"status": "healthy"}` 반환 |

#### 1.2 Frontend 컴포넌트 단위 테스트

**유틸리티 함수**

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| UT-001 | `cn()` 클래스명 병합 | TailwindCSS 클래스 충돌 해결 |
| UT-002 | `getApiUrl()` API URL 반환 | 올바른 서비스 URL 반환 |
| UT-003 | `formatDateTime()` 날짜 포맷팅 | 한국어 형식 날짜 문자열 반환 |
| UT-004 | `getSeverityLabel()` 심각도 레이블 | 1-5 레벨에 맞는 한글 레이블 반환 |
| UT-005 | `getIncidentTypeLabel()` 사고 유형 레이블 | 영문 코드 → 한글 레이블 변환 |

**CCTVGridView 컴포넌트**

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| CV-001 | 컴포넌트 렌더링 | CCTV 피드가 표시됨 |
| CV-002 | 2x2 레이아웃 표시 | 2x2 그리드 레이아웃 적용 |
| CV-003 | 3x3 레이아웃 표시 | 3x3 그리드 레이아웃 적용 |
| CV-004 | 4x4 레이아웃 표시 | 4x4 그리드 레이아웃 적용 |
| CV-005 | 빈 뷰 배열 처리 | 빈 상태 메시지 또는 플레이스홀더 표시 |
| CV-006 | 선택된 CCTV 하이라이트 | 선택된 CCTV가 시각적으로 구분됨 |

---

## 🔗 통합 테스트 (Integration Tests)

### 2.1 API 통합 테스트

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| IT-001 | 공장 생성 → CCTV 설정 추가 → 사고 발생 | 전체 플로우 정상 동작 |
| IT-002 | 사고 발생 → Redis Pub/Sub 발행 | Redis 채널에 메시지 발행 확인 |
| IT-003 | 다중 공장 생성 및 조회 | 각 공장이 독립적으로 관리됨 |
| IT-004 | 사고 생성 → 해결 처리 → 삭제 | 상태 변경이 올바르게 반영됨 |

### 2.2 SSE (Server-Sent Events) 통신 테스트

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| SSE-001 | SSE 연결 수립 | `text/event-stream` 응답 수신 |
| SSE-002 | 사고 발생 시 SSE 이벤트 수신 | 클라이언트가 실시간 이벤트 수신 |
| SSE-003 | SSE 연결 끊김 시 재연결 | 자동 재연결 로직 동작 |
| SSE-004 | 다중 클라이언트 동시 연결 | 모든 클라이언트가 이벤트 수신 |

---

## 🎭 E2E 테스트 (End-to-End Tests)

### 3.1 모니터링 페이지 E2E

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| E2E-001 | 모니터링 페이지 로드 | 페이지가 정상적으로 렌더링됨 |
| E2E-002 | CCTV 그리드 뷰 표시 | CCTV 피드가 그리드로 표시됨 |
| E2E-003 | 레이아웃 변경 버튼 클릭 | 레이아웃이 변경됨 (2x2 ↔ 3x3 ↔ 4x4) |
| E2E-004 | CCTV 전체화면 모드 | 단일 CCTV가 전체화면으로 표시됨 |
| E2E-005 | CCTV 설정 패널 열기/닫기 | 설정 패널이 토글됨 |

### 3.2 사고 페이지 E2E

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| E2E-101 | 사고 페이지 로드 | 페이지가 정상적으로 렌더링됨 |
| E2E-102 | 사고 목록 표시 | 사고 목록이 테이블 또는 리스트로 표시됨 |
| E2E-103 | 사고 상세 정보 모달 | 사고 클릭 시 상세 정보 표시 |
| E2E-104 | 사고 필터링/검색 | 필터 조건에 맞는 사고만 표시됨 |

### 3.3 사고 트리거 E2E

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| E2E-201 | 수동 사고 트리거 버튼 클릭 | 사고 생성 UI 표시 |
| E2E-202 | 사고 유형 선택 | 드롭다운에서 유형 선택 가능 |
| E2E-203 | 사고 위치 지정 (3D 좌표) | 3D 씬에서 위치 선택 가능 |
| E2E-204 | 사고 심각도 설정 | 1-5 레벨 선택 가능 |
| E2E-205 | 사고 생성 확인 | 사고가 생성되고 CCTV에 이펙트 적용 |

---

## ⚡ 성능 테스트

### 4.1 Frontend 성능 테스트

| 시나리오 ID | 테스트 케이스 | 성능 목표 |
|------------|--------------|----------|
| PERF-001 | WebGPU 렌더링 FPS | 60 FPS 이상 유지 |
| PERF-002 | 다중 CCTV 렌더링 (4개) | 30 FPS 이상 유지 |
| PERF-003 | 다중 CCTV 렌더링 (9개) | 20 FPS 이상 유지 |
| PERF-004 | 텍스처 메모리 사용량 | 512MB 이하 |
| PERF-005 | 프레임 시간 | 평균 16.67ms 이하 (60fps 기준) |
| PERF-006 | Draw Call 최적화 | 프레임당 100개 이하 |
| PERF-007 | 메모리 누수 점검 | 장시간 실행 시 메모리 증가 없음 |

### 4.2 Backend 성능 테스트

| 시나리오 ID | 테스트 케이스 | 성능 목표 |
|------------|--------------|----------|
| PERF-101 | 공장 생성 API 응답 시간 | 200ms 이하 |
| PERF-102 | 공장 목록 조회 응답 시간 | 100ms 이하 |
| PERF-103 | 사고 생성 API 응답 시간 | 150ms 이하 |
| PERF-104 | Redis 캐싱 효과 | 캐시 히트 시 50ms 이하 |
| PERF-105 | 데이터베이스 쿼리 최적화 | 인덱스 활용, N+1 문제 없음 |
| PERF-106 | 동시 요청 처리 (100 req/s) | 에러율 1% 이하 |

---

## 🌐 브라우저 호환성 테스트

### 5.1 WebGPU 지원 테스트

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| COMPAT-001 | Chrome WebGPU 지원 체크 | WebGPU 렌더러 사용 또는 폴백 |
| COMPAT-002 | Edge WebGPU 지원 체크 | WebGPU 렌더러 사용 또는 폴백 |
| COMPAT-003 | Firefox WebGPU 미지원 | WebGL 폴백 렌더러 사용 |
| COMPAT-004 | Safari WebGPU 미지원 | WebGL 폴백 렌더러 사용 |
| COMPAT-005 | WebGPU 미지원 브라우저 경고 | 사용자에게 경고 메시지 표시 |

### 5.2 기능 호환성 테스트

| 시나리오 ID | 테스트 케이스 | 예상 결과 |
|------------|--------------|----------|
| COMPAT-101 | 모바일 브라우저 (iOS Safari) | 기본 기능 동작, 성능 저하 허용 |
| COMPAT-102 | 모바일 브라우저 (Chrome Android) | 기본 기능 동작 |
| COMPAT-103 | 태블릿 브라우저 | 반응형 레이아웃 적용 |

---

## 📊 테스트 실행 방법

### Backend 테스트 실행

```bash
# Factory Core Service 테스트
cd services/factory-core
pytest tests/ -v --cov=. --cov-report=html

# Incident Event Service 테스트
cd services/incident-event
pytest tests/ -v --cov=. --cov-report=html

# Asset Management Service 테스트
cd services/asset-management
pytest tests/ -v --cov=. --cov-report=html
```

### Frontend 테스트 실행

```bash
# 단위 테스트
cd frontend
npm test

# 커버리지 포함
npm run test:coverage

# E2E 테스트
npm run test:e2e

# E2E 테스트 (UI 모드)
npm run test:e2e:ui
```

### 전체 테스트 실행 (Docker)

```bash
# 모든 서비스 테스트 실행
docker compose exec factory-core pytest tests/ -v
docker compose exec incident-event pytest tests/ -v
docker compose exec asset-management pytest tests/ -v
```

---

## 📈 테스트 커버리지 목표

- **Backend API**: 80% 이상
- **Frontend 컴포넌트**: 70% 이상
- **유틸리티 함수**: 90% 이상
- **통합 테스트**: 주요 플로우 100% 커버

---

## 🔍 테스트 결과 검증 기준

### 성공 기준

1. **단위 테스트**: 모든 테스트 케이스 통과
2. **통합 테스트**: 주요 플로우 정상 동작
3. **E2E 테스트**: 사용자 시나리오 정상 동작
4. **성능 테스트**: 목표 성능 지표 달성
5. **호환성 테스트**: 지원 브라우저에서 정상 동작

### 실패 시 조치

1. 실패한 테스트 케이스 로그 확인
2. 버그 리포트 작성 및 우선순위 설정
3. 수정 후 재테스트
4. 회귀 테스트 실행

---

## 📝 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0.0 | 2026-01-13 | 최초 작성 |
